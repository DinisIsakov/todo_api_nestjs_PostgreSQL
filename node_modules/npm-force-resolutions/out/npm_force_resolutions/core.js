// Compiled by ClojureScript 1.10.597 {:target :nodejs}
goog.provide('npm_force_resolutions.core');
goog.require('cljs.core');
goog.require('cljs.nodejs');
goog.require('cljs_http.client');
goog.require('cljs.core.async');
goog.require('clojure.string');
goog.require('cognitect.transit');
npm_force_resolutions.core.node$module$xmlhttprequest = require('xmlhttprequest');
npm_force_resolutions.core.node$module$child_process = require('child_process');
(XMLHttpRequest = npm_force_resolutions.core.node$module$xmlhttprequest.XMLHttpRequest);
npm_force_resolutions.core.node_slurp = (function npm_force_resolutions$core$node_slurp(path){
var fs = cljs.nodejs.require.call(null,"fs");
return fs.readFileSync(path,"utf8");
});
npm_force_resolutions.core.node_spit = (function npm_force_resolutions$core$node_spit(path,data){
var fs = cljs.nodejs.require.call(null,"fs");
return fs.writeFileSync(path,data);
});
npm_force_resolutions.core.read_json = (function npm_force_resolutions$core$read_json(path){
return cognitect.transit.read.call(null,cognitect.transit.reader.call(null,new cljs.core.Keyword(null,"json","json",1279968570)),clojure.string.replace.call(null,npm_force_resolutions.core.node_slurp.call(null,path),/\^/,"\\\\^"));
});
npm_force_resolutions.core.fetch_resolved_resolution = (function npm_force_resolutions$core$fetch_resolved_resolution(registry_url,key,version){
var c__2167__auto__ = cljs.core.async.chan.call(null,(1));
cljs.core.async.impl.dispatch.run.call(null,(function (){
var f__2168__auto__ = (function (){var switch__2144__auto__ = (function (state_2262){
var state_val_2263 = (state_2262[(1)]);
if((state_val_2263 === (1))){
var inst_2245 = [cljs.core.str.cljs$core$IFn$_invoke$arity$1(registry_url),cljs.core.str.cljs$core$IFn$_invoke$arity$1(key),"/",cljs.core.str.cljs$core$IFn$_invoke$arity$1(version)].join('');
var inst_2246 = cljs_http.client.get.call(null,inst_2245);
var state_2262__$1 = state_2262;
return cljs.core.async.impl.ioc_helpers.take_BANG_.call(null,state_2262__$1,(2),inst_2246);
} else {
if((state_val_2263 === (2))){
var inst_2248 = (state_2262[(2)]);
var inst_2249 = cljs.core.PersistentVector.EMPTY_NODE;
var inst_2250 = [new cljs.core.Keyword(null,"body","body",-2049205669),new cljs.core.Keyword(null,"dist","dist",-1401837144)];
var inst_2251 = (new cljs.core.PersistentVector(null,2,(5),inst_2249,inst_2250,null));
var inst_2252 = cljs.core.get_in.call(null,inst_2248,inst_2251);
var inst_2253 = [key];
var inst_2254 = ["version","resolved","integrity"];
var inst_2255 = cljs.core.get.call(null,inst_2252,new cljs.core.Keyword(null,"tarball","tarball",697016887));
var inst_2256 = cljs.core.get.call(null,inst_2252,new cljs.core.Keyword(null,"integrity","integrity",-562947111));
var inst_2257 = [version,inst_2255,inst_2256];
var inst_2258 = cljs.core.PersistentHashMap.fromArrays(inst_2254,inst_2257);
var inst_2259 = [inst_2258];
var inst_2260 = cljs.core.PersistentHashMap.fromArrays(inst_2253,inst_2259);
var state_2262__$1 = state_2262;
return cljs.core.async.impl.ioc_helpers.return_chan.call(null,state_2262__$1,inst_2260);
} else {
return null;
}
}
});
return (function() {
var npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto__ = null;
var npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto____0 = (function (){
var statearr_2264 = [null,null,null,null,null,null,null];
(statearr_2264[(0)] = npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto__);

(statearr_2264[(1)] = (1));

return statearr_2264;
});
var npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto____1 = (function (state_2262){
while(true){
var ret_value__2146__auto__ = (function (){try{while(true){
var result__2147__auto__ = switch__2144__auto__.call(null,state_2262);
if(cljs.core.keyword_identical_QMARK_.call(null,result__2147__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
continue;
} else {
return result__2147__auto__;
}
break;
}
}catch (e2265){if((e2265 instanceof Object)){
var ex__2148__auto__ = e2265;
var statearr_2266_2268 = state_2262;
(statearr_2266_2268[(5)] = ex__2148__auto__);


cljs.core.async.impl.ioc_helpers.process_exception.call(null,state_2262);

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
throw e2265;

}
}})();
if(cljs.core.keyword_identical_QMARK_.call(null,ret_value__2146__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
var G__2269 = state_2262;
state_2262 = G__2269;
continue;
} else {
return ret_value__2146__auto__;
}
break;
}
});
npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto__ = function(state_2262){
switch(arguments.length){
case 0:
return npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto____0.call(this);
case 1:
return npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto____1.call(this,state_2262);
}
throw(new Error('Invalid arity: ' + arguments.length));
};
npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$0 = npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto____0;
npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$1 = npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto____1;
return npm_force_resolutions$core$fetch_resolved_resolution_$_state_machine__2145__auto__;
})()
})();
var state__2169__auto__ = (function (){var statearr_2267 = f__2168__auto__.call(null);
(statearr_2267[(6)] = c__2167__auto__);

return statearr_2267;
})();
return cljs.core.async.impl.ioc_helpers.run_state_machine_wrapped.call(null,state__2169__auto__);
}));

return c__2167__auto__;
});
npm_force_resolutions.core.wait_all = (function npm_force_resolutions$core$wait_all(callbacks){
var c__2167__auto__ = cljs.core.async.chan.call(null,(1));
cljs.core.async.impl.dispatch.run.call(null,(function (){
var f__2168__auto__ = (function (){var switch__2144__auto__ = (function (state_2288){
var state_val_2289 = (state_2288[(1)]);
if((state_val_2289 === (1))){
var inst_2270 = cljs.core.async.merge.call(null,callbacks);
var inst_2271 = cljs.core.PersistentHashMap.EMPTY;
var inst_2272 = inst_2271;
var state_2288__$1 = (function (){var statearr_2290 = state_2288;
(statearr_2290[(7)] = inst_2270);

(statearr_2290[(8)] = inst_2272);

return statearr_2290;
})();
var statearr_2291_2302 = state_2288__$1;
(statearr_2291_2302[(2)] = null);

(statearr_2291_2302[(1)] = (2));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2289 === (2))){
var inst_2272 = (state_2288[(8)]);
var inst_2274 = cljs.core.count.call(null,inst_2272);
var inst_2275 = cljs.core.count.call(null,callbacks);
var inst_2276 = cljs.core._EQ_.call(null,inst_2274,inst_2275);
var state_2288__$1 = state_2288;
if(inst_2276){
var statearr_2292_2303 = state_2288__$1;
(statearr_2292_2303[(1)] = (4));

} else {
var statearr_2293_2304 = state_2288__$1;
(statearr_2293_2304[(1)] = (5));

}

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2289 === (3))){
var inst_2286 = (state_2288[(2)]);
var state_2288__$1 = state_2288;
return cljs.core.async.impl.ioc_helpers.return_chan.call(null,state_2288__$1,inst_2286);
} else {
if((state_val_2289 === (4))){
var inst_2272 = (state_2288[(8)]);
var state_2288__$1 = state_2288;
var statearr_2294_2305 = state_2288__$1;
(statearr_2294_2305[(2)] = inst_2272);

(statearr_2294_2305[(1)] = (6));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2289 === (5))){
var inst_2270 = (state_2288[(7)]);
var state_2288__$1 = state_2288;
return cljs.core.async.impl.ioc_helpers.take_BANG_.call(null,state_2288__$1,(7),inst_2270);
} else {
if((state_val_2289 === (6))){
var inst_2284 = (state_2288[(2)]);
var state_2288__$1 = state_2288;
var statearr_2295_2306 = state_2288__$1;
(statearr_2295_2306[(2)] = inst_2284);

(statearr_2295_2306[(1)] = (3));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2289 === (7))){
var inst_2272 = (state_2288[(8)]);
var inst_2280 = (state_2288[(2)]);
var inst_2281 = cljs.core.merge.call(null,inst_2272,inst_2280);
var inst_2272__$1 = inst_2281;
var state_2288__$1 = (function (){var statearr_2296 = state_2288;
(statearr_2296[(8)] = inst_2272__$1);

return statearr_2296;
})();
var statearr_2297_2307 = state_2288__$1;
(statearr_2297_2307[(2)] = null);

(statearr_2297_2307[(1)] = (2));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
return null;
}
}
}
}
}
}
}
});
return (function() {
var npm_force_resolutions$core$wait_all_$_state_machine__2145__auto__ = null;
var npm_force_resolutions$core$wait_all_$_state_machine__2145__auto____0 = (function (){
var statearr_2298 = [null,null,null,null,null,null,null,null,null];
(statearr_2298[(0)] = npm_force_resolutions$core$wait_all_$_state_machine__2145__auto__);

(statearr_2298[(1)] = (1));

return statearr_2298;
});
var npm_force_resolutions$core$wait_all_$_state_machine__2145__auto____1 = (function (state_2288){
while(true){
var ret_value__2146__auto__ = (function (){try{while(true){
var result__2147__auto__ = switch__2144__auto__.call(null,state_2288);
if(cljs.core.keyword_identical_QMARK_.call(null,result__2147__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
continue;
} else {
return result__2147__auto__;
}
break;
}
}catch (e2299){if((e2299 instanceof Object)){
var ex__2148__auto__ = e2299;
var statearr_2300_2308 = state_2288;
(statearr_2300_2308[(5)] = ex__2148__auto__);


cljs.core.async.impl.ioc_helpers.process_exception.call(null,state_2288);

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
throw e2299;

}
}})();
if(cljs.core.keyword_identical_QMARK_.call(null,ret_value__2146__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
var G__2309 = state_2288;
state_2288 = G__2309;
continue;
} else {
return ret_value__2146__auto__;
}
break;
}
});
npm_force_resolutions$core$wait_all_$_state_machine__2145__auto__ = function(state_2288){
switch(arguments.length){
case 0:
return npm_force_resolutions$core$wait_all_$_state_machine__2145__auto____0.call(this);
case 1:
return npm_force_resolutions$core$wait_all_$_state_machine__2145__auto____1.call(this,state_2288);
}
throw(new Error('Invalid arity: ' + arguments.length));
};
npm_force_resolutions$core$wait_all_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$0 = npm_force_resolutions$core$wait_all_$_state_machine__2145__auto____0;
npm_force_resolutions$core$wait_all_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$1 = npm_force_resolutions$core$wait_all_$_state_machine__2145__auto____1;
return npm_force_resolutions$core$wait_all_$_state_machine__2145__auto__;
})()
})();
var state__2169__auto__ = (function (){var statearr_2301 = f__2168__auto__.call(null);
(statearr_2301[(6)] = c__2167__auto__);

return statearr_2301;
})();
return cljs.core.async.impl.ioc_helpers.run_state_machine_wrapped.call(null,state__2169__auto__);
}));

return c__2167__auto__;
});
npm_force_resolutions.core.get_registry_url = (function npm_force_resolutions$core$get_registry_url(){
return npm_force_resolutions.core.node$module$child_process.execSync("npm config get registry").toString().trim();
});
npm_force_resolutions.core.find_resolutions = (function npm_force_resolutions$core$find_resolutions(folder){
var c__2167__auto__ = cljs.core.async.chan.call(null,(1));
cljs.core.async.impl.dispatch.run.call(null,(function (){
var f__2168__auto__ = (function (){var switch__2144__auto__ = (function (state_2337){
var state_val_2338 = (state_2337[(1)]);
if((state_val_2338 === (1))){
var inst_2313 = [cljs.core.str.cljs$core$IFn$_invoke$arity$1(folder),"/package.json"].join('');
var inst_2314 = npm_force_resolutions.core.read_json.call(null,inst_2313);
var inst_2315 = cljs.core.get.call(null,inst_2314,"resolutions");
var inst_2316 = npm_force_resolutions.core.get_registry_url.call(null);
var inst_2318 = (function (){var package_json = inst_2314;
var resolutions = inst_2315;
var registry_url = inst_2316;
return (function (p__2317){
var vec__2339 = p__2317;
var k = cljs.core.nth.call(null,vec__2339,(0),null);
var v = cljs.core.nth.call(null,vec__2339,(1),null);
return npm_force_resolutions.core.fetch_resolved_resolution.call(null,registry_url,k,v);
});
})();
var inst_2319 = cljs.core.seq.call(null,inst_2315);
var inst_2320 = cljs.core.map.call(null,inst_2318,inst_2319);
var inst_2321 = cljs.core.PersistentVector.EMPTY_NODE;
var inst_2322 = npm_force_resolutions.core.wait_all.call(null,inst_2320);
var inst_2323 = cljs.core.async.timeout.call(null,(8000));
var inst_2324 = [inst_2322,inst_2323];
var inst_2325 = (new cljs.core.PersistentVector(null,2,(5),inst_2321,inst_2324,null));
var state_2337__$1 = state_2337;
return cljs.core.async.ioc_alts_BANG_.call(null,state_2337__$1,(2),inst_2325);
} else {
if((state_val_2338 === (2))){
var inst_2328 = (state_2337[(7)]);
var inst_2327 = (state_2337[(2)]);
var inst_2328__$1 = cljs.core.nth.call(null,inst_2327,(0),null);
var inst_2329 = cljs.core.nth.call(null,inst_2327,(1),null);
var state_2337__$1 = (function (){var statearr_2342 = state_2337;
(statearr_2342[(8)] = inst_2329);

(statearr_2342[(7)] = inst_2328__$1);

return statearr_2342;
})();
if(cljs.core.truth_(inst_2328__$1)){
var statearr_2343_2351 = state_2337__$1;
(statearr_2343_2351[(1)] = (3));

} else {
var statearr_2344_2352 = state_2337__$1;
(statearr_2344_2352[(1)] = (4));

}

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2338 === (3))){
var inst_2328 = (state_2337[(7)]);
var state_2337__$1 = state_2337;
var statearr_2345_2353 = state_2337__$1;
(statearr_2345_2353[(2)] = inst_2328);

(statearr_2345_2353[(1)] = (5));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2338 === (4))){
var inst_2332 = (new Error("Timeout trying to fetch resolutions from npm"));
var inst_2333 = (function(){throw inst_2332})();
var state_2337__$1 = state_2337;
var statearr_2346_2354 = state_2337__$1;
(statearr_2346_2354[(2)] = inst_2333);

(statearr_2346_2354[(1)] = (5));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2338 === (5))){
var inst_2335 = (state_2337[(2)]);
var state_2337__$1 = state_2337;
return cljs.core.async.impl.ioc_helpers.return_chan.call(null,state_2337__$1,inst_2335);
} else {
return null;
}
}
}
}
}
});
return (function() {
var npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto__ = null;
var npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto____0 = (function (){
var statearr_2347 = [null,null,null,null,null,null,null,null,null];
(statearr_2347[(0)] = npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto__);

(statearr_2347[(1)] = (1));

return statearr_2347;
});
var npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto____1 = (function (state_2337){
while(true){
var ret_value__2146__auto__ = (function (){try{while(true){
var result__2147__auto__ = switch__2144__auto__.call(null,state_2337);
if(cljs.core.keyword_identical_QMARK_.call(null,result__2147__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
continue;
} else {
return result__2147__auto__;
}
break;
}
}catch (e2348){if((e2348 instanceof Object)){
var ex__2148__auto__ = e2348;
var statearr_2349_2355 = state_2337;
(statearr_2349_2355[(5)] = ex__2148__auto__);


cljs.core.async.impl.ioc_helpers.process_exception.call(null,state_2337);

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
throw e2348;

}
}})();
if(cljs.core.keyword_identical_QMARK_.call(null,ret_value__2146__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
var G__2356 = state_2337;
state_2337 = G__2356;
continue;
} else {
return ret_value__2146__auto__;
}
break;
}
});
npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto__ = function(state_2337){
switch(arguments.length){
case 0:
return npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto____0.call(this);
case 1:
return npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto____1.call(this,state_2337);
}
throw(new Error('Invalid arity: ' + arguments.length));
};
npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$0 = npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto____0;
npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$1 = npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto____1;
return npm_force_resolutions$core$find_resolutions_$_state_machine__2145__auto__;
})()
})();
var state__2169__auto__ = (function (){var statearr_2350 = f__2168__auto__.call(null);
(statearr_2350[(6)] = c__2167__auto__);

return statearr_2350;
})();
return cljs.core.async.impl.ioc_helpers.run_state_machine_wrapped.call(null,state__2169__auto__);
}));

return c__2167__auto__;
});
npm_force_resolutions.core.map_vals = (function npm_force_resolutions$core$map_vals(f,m){
return cljs.core.apply.call(null,cljs.core.merge,cljs.core.map.call(null,(function (p__2357){
var vec__2358 = p__2357;
var k = cljs.core.nth.call(null,vec__2358,(0),null);
var v = cljs.core.nth.call(null,vec__2358,(1),null);
return cljs.core.PersistentArrayMap.createAsIfByAssoc([k,f.call(null,k,v)]);
}),m));
});
npm_force_resolutions.core.update_on_requires = (function npm_force_resolutions$core$update_on_requires(resolutions,dependency){
return cljs.core.update.call(null,dependency,"requires",(function (requires){
return npm_force_resolutions.core.map_vals.call(null,(function (p1__2361_SHARP_,p2__2362_SHARP_){
return (function (key,version){
if(cljs.core.contains_QMARK_.call(null,resolutions,key)){
return cljs.core.get_in.call(null,resolutions,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [key,"version"], null));
} else {
return version;
}
}).call(null,p1__2361_SHARP_,p2__2362_SHARP_);
}),requires);
}));
});
npm_force_resolutions.core.add_dependencies = (function npm_force_resolutions$core$add_dependencies(resolutions,dependency){
var required_dependencies = cljs.core.keys.call(null,cljs.core.get.call(null,dependency,"requires"));
var new_deps = cljs.core.select_keys.call(null,resolutions,required_dependencies);
var dependencies = cljs.core.merge.call(null,new_deps,cljs.core.get.call(null,dependency,"dependencies",cljs.core.PersistentArrayMap.EMPTY));
return cljs.core.merge.call(null,dependency,new cljs.core.PersistentArrayMap(null, 1, ["dependencies",dependencies], null));
});
npm_force_resolutions.core.fix_existing_dependency = (function npm_force_resolutions$core$fix_existing_dependency(resolutions,key,dependency){
if(cljs.core.contains_QMARK_.call(null,resolutions,key)){
var fixed_dep = cljs.core.conj.call(null,cljs.core.dissoc.call(null,dependency,"version","resolved","integrity","bundled"),cljs.core.get.call(null,resolutions,key));
return cljs.core.into.call(null,cljs.core.sorted_map_by.call(null,(function (p1__2363_SHARP_,p2__2364_SHARP_){
return cljs.core.compare.call(null,cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,fixed_dep,p1__2363_SHARP_)),cljs.core.str.cljs$core$IFn$_invoke$arity$1(cljs.core.get.call(null,fixed_dep,p2__2364_SHARP_)));
})),fixed_dep);
} else {
return dependency;
}
});
npm_force_resolutions.core.order_map = (function npm_force_resolutions$core$order_map(target){
return cljs.core.into.call(null,cljs.core.sorted_map_by.call(null,(function (key1,key2){
return cljs.core.compare.call(null,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [key1], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [key2], null));
})),target);
});
npm_force_resolutions.core.sort_or_remove_map = (function npm_force_resolutions$core$sort_or_remove_map(key,dependency){
if(cljs.core.map_QMARK_.call(null,cljs.core.get.call(null,dependency,key))){
return cljs.core.update.call(null,dependency,key,npm_force_resolutions.core.order_map);
} else {
return cljs.core.dissoc.call(null,dependency,key);
}
});
npm_force_resolutions.core.patch_dependency = (function npm_force_resolutions$core$patch_dependency(resolutions,key,dependency){
if(cljs.core.contains_QMARK_.call(null,dependency,"requires")){
return npm_force_resolutions.core.sort_or_remove_map.call(null,"requires",npm_force_resolutions.core.sort_or_remove_map.call(null,"dependencies",npm_force_resolutions.core.patch_all_dependencies.call(null,resolutions,npm_force_resolutions.core.fix_existing_dependency.call(null,resolutions,key,npm_force_resolutions.core.update_on_requires.call(null,resolutions,npm_force_resolutions.core.add_dependencies.call(null,resolutions,dependency))))));
} else {
return npm_force_resolutions.core.fix_existing_dependency.call(null,resolutions,key,dependency);
}
});
npm_force_resolutions.core.patch_all_dependencies = (function npm_force_resolutions$core$patch_all_dependencies(resolutions,package_lock){
return cljs.core.update.call(null,package_lock,"dependencies",(function (dependencies){
return npm_force_resolutions.core.map_vals.call(null,(function (p1__2365_SHARP_,p2__2366_SHARP_){
return npm_force_resolutions.core.patch_dependency.call(null,resolutions,p1__2365_SHARP_,p2__2366_SHARP_);
}),dependencies);
}));
});
npm_force_resolutions.core.update_package_lock = (function npm_force_resolutions$core$update_package_lock(folder){
var c__2167__auto__ = cljs.core.async.chan.call(null,(1));
cljs.core.async.impl.dispatch.run.call(null,(function (){
var f__2168__auto__ = (function (){var switch__2144__auto__ = (function (state_2375){
var state_val_2376 = (state_2375[(1)]);
if((state_val_2376 === (1))){
var inst_2367 = [cljs.core.str.cljs$core$IFn$_invoke$arity$1(folder),"/package-lock.json"].join('');
var inst_2368 = npm_force_resolutions.core.read_json.call(null,inst_2367);
var inst_2369 = npm_force_resolutions.core.find_resolutions.call(null,folder);
var state_2375__$1 = (function (){var statearr_2377 = state_2375;
(statearr_2377[(7)] = inst_2368);

return statearr_2377;
})();
return cljs.core.async.impl.ioc_helpers.take_BANG_.call(null,state_2375__$1,(2),inst_2369);
} else {
if((state_val_2376 === (2))){
var inst_2368 = (state_2375[(7)]);
var inst_2371 = (state_2375[(2)]);
var inst_2372 = npm_force_resolutions.core.patch_all_dependencies.call(null,inst_2371,inst_2368);
var inst_2373 = npm_force_resolutions.core.sort_or_remove_map.call(null,"dependencies",inst_2372);
var state_2375__$1 = state_2375;
return cljs.core.async.impl.ioc_helpers.return_chan.call(null,state_2375__$1,inst_2373);
} else {
return null;
}
}
});
return (function() {
var npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto__ = null;
var npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto____0 = (function (){
var statearr_2378 = [null,null,null,null,null,null,null,null];
(statearr_2378[(0)] = npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto__);

(statearr_2378[(1)] = (1));

return statearr_2378;
});
var npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto____1 = (function (state_2375){
while(true){
var ret_value__2146__auto__ = (function (){try{while(true){
var result__2147__auto__ = switch__2144__auto__.call(null,state_2375);
if(cljs.core.keyword_identical_QMARK_.call(null,result__2147__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
continue;
} else {
return result__2147__auto__;
}
break;
}
}catch (e2379){if((e2379 instanceof Object)){
var ex__2148__auto__ = e2379;
var statearr_2380_2382 = state_2375;
(statearr_2380_2382[(5)] = ex__2148__auto__);


cljs.core.async.impl.ioc_helpers.process_exception.call(null,state_2375);

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
throw e2379;

}
}})();
if(cljs.core.keyword_identical_QMARK_.call(null,ret_value__2146__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
var G__2383 = state_2375;
state_2375 = G__2383;
continue;
} else {
return ret_value__2146__auto__;
}
break;
}
});
npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto__ = function(state_2375){
switch(arguments.length){
case 0:
return npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto____0.call(this);
case 1:
return npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto____1.call(this,state_2375);
}
throw(new Error('Invalid arity: ' + arguments.length));
};
npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$0 = npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto____0;
npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$1 = npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto____1;
return npm_force_resolutions$core$update_package_lock_$_state_machine__2145__auto__;
})()
})();
var state__2169__auto__ = (function (){var statearr_2381 = f__2168__auto__.call(null);
(statearr_2381[(6)] = c__2167__auto__);

return statearr_2381;
})();
return cljs.core.async.impl.ioc_helpers.run_state_machine_wrapped.call(null,state__2169__auto__);
}));

return c__2167__auto__;
});
npm_force_resolutions.core.indent_json = (function npm_force_resolutions$core$indent_json(json){
var json_format = cljs.nodejs.require.call(null,"json-format");
return clojure.string.replace.call(null,clojure.string.replace.call(null,json_format.call(null,JSON.parse(json),(function (){var obj2385 = ({"type":"space","size":(2)});
return obj2385;
})()),/\\\\\^/,"^"),/ +\n/,"");
});
npm_force_resolutions.core.main = (function npm_force_resolutions$core$main(var_args){
var args__4795__auto__ = [];
var len__4789__auto___2413 = arguments.length;
var i__4790__auto___2414 = (0);
while(true){
if((i__4790__auto___2414 < len__4789__auto___2413)){
args__4795__auto__.push((arguments[i__4790__auto___2414]));

var G__2415 = (i__4790__auto___2414 + (1));
i__4790__auto___2414 = G__2415;
continue;
} else {
}
break;
}

var argseq__4796__auto__ = ((((0) < args__4795__auto__.length))?(new cljs.core.IndexedSeq(args__4795__auto__.slice((0)),(0),null)):null);
return npm_force_resolutions.core.main.cljs$core$IFn$_invoke$arity$variadic(argseq__4796__auto__);
});

(npm_force_resolutions.core.main.cljs$core$IFn$_invoke$arity$variadic = (function (args){
var c__2167__auto__ = cljs.core.async.chan.call(null,(1));
cljs.core.async.impl.dispatch.run.call(null,(function (){
var f__2168__auto__ = (function (){var switch__2144__auto__ = (function (state_2401){
var state_val_2402 = (state_2401[(1)]);
if((state_val_2402 === (1))){
var inst_2387 = (state_2401[(7)]);
var inst_2387__$1 = cljs.core.first.call(null,args);
var state_2401__$1 = (function (){var statearr_2403 = state_2401;
(statearr_2403[(7)] = inst_2387__$1);

return statearr_2403;
})();
if(cljs.core.truth_(inst_2387__$1)){
var statearr_2404_2416 = state_2401__$1;
(statearr_2404_2416[(1)] = (2));

} else {
var statearr_2405_2417 = state_2401__$1;
(statearr_2405_2417[(1)] = (3));

}

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2402 === (2))){
var inst_2387 = (state_2401[(7)]);
var state_2401__$1 = state_2401;
var statearr_2406_2418 = state_2401__$1;
(statearr_2406_2418[(2)] = inst_2387);

(statearr_2406_2418[(1)] = (4));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2402 === (3))){
var state_2401__$1 = state_2401;
var statearr_2407_2419 = state_2401__$1;
(statearr_2407_2419[(2)] = ".");

(statearr_2407_2419[(1)] = (4));


return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
if((state_val_2402 === (4))){
var inst_2391 = (state_2401[(8)]);
var inst_2391__$1 = (state_2401[(2)]);
var inst_2392 = npm_force_resolutions.core.update_package_lock.call(null,inst_2391__$1);
var state_2401__$1 = (function (){var statearr_2408 = state_2401;
(statearr_2408[(8)] = inst_2391__$1);

return statearr_2408;
})();
return cljs.core.async.impl.ioc_helpers.take_BANG_.call(null,state_2401__$1,(5),inst_2392);
} else {
if((state_val_2402 === (5))){
var inst_2391 = (state_2401[(8)]);
var inst_2394 = (state_2401[(2)]);
var inst_2395 = cognitect.transit.writer.call(null,new cljs.core.Keyword(null,"json-verbose","json-verbose",-542533531));
var inst_2396 = cognitect.transit.write.call(null,inst_2395,inst_2394);
var inst_2397 = [cljs.core.str.cljs$core$IFn$_invoke$arity$1(inst_2391),"/package-lock.json"].join('');
var inst_2398 = npm_force_resolutions.core.indent_json.call(null,inst_2396);
var inst_2399 = npm_force_resolutions.core.node_spit.call(null,inst_2397,inst_2398);
var state_2401__$1 = state_2401;
return cljs.core.async.impl.ioc_helpers.return_chan.call(null,state_2401__$1,inst_2399);
} else {
return null;
}
}
}
}
}
});
return (function() {
var npm_force_resolutions$core$state_machine__2145__auto__ = null;
var npm_force_resolutions$core$state_machine__2145__auto____0 = (function (){
var statearr_2409 = [null,null,null,null,null,null,null,null,null];
(statearr_2409[(0)] = npm_force_resolutions$core$state_machine__2145__auto__);

(statearr_2409[(1)] = (1));

return statearr_2409;
});
var npm_force_resolutions$core$state_machine__2145__auto____1 = (function (state_2401){
while(true){
var ret_value__2146__auto__ = (function (){try{while(true){
var result__2147__auto__ = switch__2144__auto__.call(null,state_2401);
if(cljs.core.keyword_identical_QMARK_.call(null,result__2147__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
continue;
} else {
return result__2147__auto__;
}
break;
}
}catch (e2410){if((e2410 instanceof Object)){
var ex__2148__auto__ = e2410;
var statearr_2411_2420 = state_2401;
(statearr_2411_2420[(5)] = ex__2148__auto__);


cljs.core.async.impl.ioc_helpers.process_exception.call(null,state_2401);

return new cljs.core.Keyword(null,"recur","recur",-437573268);
} else {
throw e2410;

}
}})();
if(cljs.core.keyword_identical_QMARK_.call(null,ret_value__2146__auto__,new cljs.core.Keyword(null,"recur","recur",-437573268))){
var G__2421 = state_2401;
state_2401 = G__2421;
continue;
} else {
return ret_value__2146__auto__;
}
break;
}
});
npm_force_resolutions$core$state_machine__2145__auto__ = function(state_2401){
switch(arguments.length){
case 0:
return npm_force_resolutions$core$state_machine__2145__auto____0.call(this);
case 1:
return npm_force_resolutions$core$state_machine__2145__auto____1.call(this,state_2401);
}
throw(new Error('Invalid arity: ' + arguments.length));
};
npm_force_resolutions$core$state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$0 = npm_force_resolutions$core$state_machine__2145__auto____0;
npm_force_resolutions$core$state_machine__2145__auto__.cljs$core$IFn$_invoke$arity$1 = npm_force_resolutions$core$state_machine__2145__auto____1;
return npm_force_resolutions$core$state_machine__2145__auto__;
})()
})();
var state__2169__auto__ = (function (){var statearr_2412 = f__2168__auto__.call(null);
(statearr_2412[(6)] = c__2167__auto__);

return statearr_2412;
})();
return cljs.core.async.impl.ioc_helpers.run_state_machine_wrapped.call(null,state__2169__auto__);
}));

return c__2167__auto__;
}));

(npm_force_resolutions.core.main.cljs$lang$maxFixedArity = (0));

/** @this {Function} */
(npm_force_resolutions.core.main.cljs$lang$applyTo = (function (seq2386){
var self__4777__auto__ = this;
return self__4777__auto__.cljs$core$IFn$_invoke$arity$variadic(cljs.core.seq.call(null,seq2386));
}));

(cljs.core._STAR_main_cli_fn_STAR_ = npm_force_resolutions.core.main);

//# sourceMappingURL=core.js.map
